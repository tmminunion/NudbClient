{"version":3,"file":"browser.js","sources":["../src/core.js","../src/browser.js"],"sourcesContent":["export class NuDBCore {\n  constructor(wsUrl, options = {}) {\n    this.wsUrl = wsUrl;\n    this.options = options;\n    this.socket = null;\n    this.listeners = {};\n    this.dataCallbacks = {};\n    this.queue = [];\n    this.headers = options.headers || {};\n    this.connect();\n  }\n\n  _generateId() {\n    const chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n    let str = \"\";\n    for (let i = 0; i < 17; i++) {\n      str += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return `${Date.now()}${str}`;\n  }\n\n  setHeader(key, value) {\n    this.headers[key] = value;\n    return this;\n  }\n\n  sendMessage(msg) {\n    const fullMsg = {\n      ...msg,\n      headers: this.headers,\n    };\n\n    if (this.socket?.readyState === 1) {\n      this.socket.send(JSON.stringify(fullMsg));\n    } else {\n      this.queue.push(fullMsg);\n    }\n    return this;\n  }\n\n  subscribe(path) {\n    this.sendMessage({ type: \"subscribe\", path });\n    return this;\n  }\n\n  on(path, callback) {\n    if (!this.listeners[path]) {\n      this.listeners[path] = [];\n      this.subscribe(path);\n    }\n    this.listeners[path].push(callback);\n    return this;\n  }\n\n  get(path, callback) {\n    if (!this.dataCallbacks[path]) {\n      this.dataCallbacks[path] = [];\n    }\n    this.dataCallbacks[path].push(callback);\n    this.sendMessage({ type: \"get\", path });\n    return this;\n  }\n\n  set(path, data) {\n    this.sendMessage({ type: \"set\", path, data });\n    return this;\n  }\n\n  push(path, data) {\n    const id = this._generateId();\n    const fullPath = `${path}/${id}`;\n    this.set(fullPath, data);\n    return id;\n  }\n\n  update(path, data) {\n    this.sendMessage({ type: \"update\", path, data });\n    return this;\n  }\n\n  delete(path) {\n    this.sendMessage({ type: \"delete\", path });\n    return this;\n  }\n\n  close() {\n    if (this.socket) {\n      this.socket.close();\n    }\n    return this;\n  }\n}","import { NuDBCore } from './core.js';\n\nexport class NuDB extends NuDBCore {\n  constructor(wsUrl, options = {}) {\n    super(wsUrl, options);\n  }\n\n  connect() {\n    this.socket = new WebSocket(this.wsUrl);\n\n    this.socket.onopen = () => {\n      console.log(\"ðŸŸ¢ NuDB WebSocket connected\");\n      this._processQueue();\n      this._resubscribe();\n    };\n\n    this.socket.onmessage = this._handleMessage.bind(this);\n    this.socket.onclose = this._handleClose.bind(this);\n  }\n\n  _processQueue() {\n    while (this.queue.length > 0) {\n      const action = this.queue.shift();\n      this.socket.send(JSON.stringify(action));\n    }\n  }\n\n  _resubscribe() {\n    Object.keys(this.listeners).forEach((path) => {\n      this.sendMessage({ type: \"subscribe\", path });\n    });\n  }\n\n  _handleMessage(event) {\n    try {\n      const msg = JSON.parse(event.data);\n      console.log(\"ðŸ“© NuDB received:\", msg);\n\n      if (msg.type === \"update\" && this.listeners[msg.path]) {\n        this.listeners[msg.path].forEach((callback) => callback(msg.data));\n      }\n\n      if (msg.type === \"data\" && this.dataCallbacks[msg.path]) {\n        this.dataCallbacks[msg.path].forEach((callback) => callback(msg.data));\n        delete this.dataCallbacks[msg.path];\n      }\n    } catch (err) {\n      console.error(\"NuDB message parse error:\", err);\n    }\n  }\n\n  _handleClose() {\n    console.warn(\"ðŸ”´ NuDB WebSocket disconnected. Reconnecting...\");\n    setTimeout(() => this.connect(), 3000);\n  }\n}"],"names":["NuDBCore","constructor","wsUrl","options","this","socket","listeners","dataCallbacks","queue","headers","connect","_generateId","chars","str","i","charAt","Math","floor","random","Date","now","setHeader","key","value","sendMessage","msg","fullMsg","readyState","send","JSON","stringify","push","subscribe","path","type","on","callback","get","set","data","id","fullPath","update","close","super","WebSocket","onopen","console","log","_processQueue","_resubscribe","onmessage","_handleMessage","bind","onclose","_handleClose","length","action","shift","Object","keys","forEach","event","parse","err","error","warn","setTimeout"],"mappings":"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"}
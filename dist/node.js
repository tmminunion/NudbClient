"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var s=e(require("isomorphic-ws"));class t{constructor(e,s={}){this.wsUrl=e,this.options=s,this.socket=null,this.listeners={},this.dataCallbacks={},this.queue=[],this.headers=s.headers||{},this.connect()}_generateId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let s="";for(let t=0;t<17;t++)s+=e.charAt(Math.floor(62*Math.random()));return`${Date.now()}${s}`}setHeader(e,s){return this.headers[e]=s,this}sendMessage(e){const s={...e,headers:this.headers};return 1===this.socket?.readyState?this.socket.send(JSON.stringify(s)):this.queue.push(s),this}subscribe(e){return this.sendMessage({type:"subscribe",path:e}),this}on(e,s){return this.listeners[e]||(this.listeners[e]=[],this.subscribe(e)),this.listeners[e].push(s),this}get(e,s){return this.dataCallbacks[e]||(this.dataCallbacks[e]=[]),this.dataCallbacks[e].push(s),this.sendMessage({type:"get",path:e}),this}set(e,s){return this.sendMessage({type:"set",path:e,data:s}),this}push(e,s){const t=this._generateId(),r=`${e}/${t}`;return this.set(r,s),t}update(e,s){return this.sendMessage({type:"update",path:e,data:s}),this}delete(e){return this.sendMessage({type:"delete",path:e}),this}close(){return this.socket&&this.socket.close(),this}}exports.NuDB=class extends t{constructor(e,s={}){super(e,s)}connect(){this.socket=new s.default(this.wsUrl),this.socket.on("open",(()=>{console.log("ðŸŸ¢ NuDB WebSocket connected"),this._processQueue(),this._resubscribe()})),this.socket.on("message",this._handleMessage.bind(this)),this.socket.on("close",this._handleClose.bind(this)),this.socket.on("error",(e=>{console.error("NuDB WebSocket error:",e)}))}};
//# sourceMappingURL=node.js.map

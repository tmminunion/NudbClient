{"version":3,"file":"node.js","sources":["../src/core.js","../src/node.js"],"sourcesContent":["export class NuDBCore {\n  constructor(wsUrl, options = {}) {\n    this.wsUrl = wsUrl;\n    this.options = options;\n    this.socket = null;\n    this.listeners = {};\n    this.dataCallbacks = {};\n    this.queue = [];\n    this.headers = options.headers || {};\n    this.connect();\n  }\n\n  _generateId() {\n    const chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n    let str = \"\";\n    for (let i = 0; i < 17; i++) {\n      str += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return `${Date.now()}${str}`;\n  }\n\n  setHeader(key, value) {\n    this.headers[key] = value;\n    return this;\n  }\n\n  sendMessage(msg) {\n    const fullMsg = {\n      ...msg,\n      headers: this.headers,\n    };\n\n    if (this.socket?.readyState === 1) {\n      this.socket.send(JSON.stringify(fullMsg));\n    } else {\n      this.queue.push(fullMsg);\n    }\n    return this;\n  }\n\n  subscribe(path) {\n    this.sendMessage({ type: \"subscribe\", path });\n    return this;\n  }\n\n  on(path, callback) {\n    if (!this.listeners[path]) {\n      this.listeners[path] = [];\n      this.subscribe(path);\n    }\n    this.listeners[path].push(callback);\n    return this;\n  }\n\n  get(path, callback) {\n    if (!this.dataCallbacks[path]) {\n      this.dataCallbacks[path] = [];\n    }\n    this.dataCallbacks[path].push(callback);\n    this.sendMessage({ type: \"get\", path });\n    return this;\n  }\n\n  set(path, data) {\n    this.sendMessage({ type: \"set\", path, data });\n    return this;\n  }\n\n  push(path, data) {\n    const id = this._generateId();\n    const fullPath = `${path}/${id}`;\n    this.set(fullPath, data);\n    return id;\n  }\n\n  update(path, data) {\n    this.sendMessage({ type: \"update\", path, data });\n    return this;\n  }\n\n  delete(path) {\n    this.sendMessage({ type: \"delete\", path });\n    return this;\n  }\n\n  close() {\n    if (this.socket) {\n      this.socket.close();\n    }\n    return this;\n  }\n}","import { NuDBCore } from './core.js';\nimport WebSocket from 'isomorphic-ws';\n\nexport class NuDB extends NuDBCore {\n  constructor(wsUrl, options = {}) {\n    super(wsUrl, options);\n  }\n\n  connect() {\n    this.socket = new WebSocket(this.wsUrl);\n\n    this.socket.on('open', () => {\n      console.log(\"ðŸŸ¢ NuDB WebSocket connected\");\n      this._processQueue();\n      this._resubscribe();\n    });\n\n    this.socket.on('message', this._handleMessage.bind(this));\n    this.socket.on('close', this._handleClose.bind(this));\n    this.socket.on('error', (err) => {\n      console.error(\"NuDB WebSocket error:\", err);\n    });\n  }\n\n  // ... (same helper methods as browser implementation)\n}"],"names":["NuDBCore","constructor","wsUrl","options","this","socket","listeners","dataCallbacks","queue","headers","connect","_generateId","chars","str","i","charAt","Math","floor","random","Date","now","setHeader","key","value","sendMessage","msg","fullMsg","readyState","send","JSON","stringify","push","subscribe","path","type","on","callback","get","set","data","id","fullPath","update","close","super","WebSocket","console","log","_processQueue","_resubscribe","_handleMessage","bind","_handleClose","err","error"],"mappings":"8KAAO,MAAMA,EACX,WAAAC,CAAYC,EAAOC,EAAU,IAC3BC,KAAKF,MAAQA,EACbE,KAAKD,QAAUA,EACfC,KAAKC,OAAS,KACdD,KAAKE,UAAY,GACjBF,KAAKG,cAAgB,GACrBH,KAAKI,MAAQ,GACbJ,KAAKK,QAAUN,EAAQM,SAAW,CAAA,EAClCL,KAAKM,SACN,CAED,WAAAC,GACE,MAAMC,EAAQ,iEACd,IAAIC,EAAM,GACV,IAAK,IAAIC,EAAI,EAAGA,EAAI,GAAIA,IACtBD,GAAOD,EAAMG,OAAOC,KAAKC,MAAsBL,GAAhBI,KAAKE,WAEtC,MAAO,GAAGC,KAAKC,QAAQP,GACxB,CAED,SAAAQ,CAAUC,EAAKC,GAEb,OADAnB,KAAKK,QAAQa,GAAOC,EACbnB,IACR,CAED,WAAAoB,CAAYC,GACV,MAAMC,EAAU,IACXD,EACHhB,QAASL,KAAKK,SAQhB,OALgC,IAA5BL,KAAKC,QAAQsB,WACfvB,KAAKC,OAAOuB,KAAKC,KAAKC,UAAUJ,IAEhCtB,KAAKI,MAAMuB,KAAKL,GAEXtB,IACR,CAED,SAAA4B,CAAUC,GAER,OADA7B,KAAKoB,YAAY,CAAEU,KAAM,YAAaD,SAC/B7B,IACR,CAED,EAAA+B,CAAGF,EAAMG,GAMP,OALKhC,KAAKE,UAAU2B,KAClB7B,KAAKE,UAAU2B,GAAQ,GACvB7B,KAAK4B,UAAUC,IAEjB7B,KAAKE,UAAU2B,GAAMF,KAAKK,GACnBhC,IACR,CAED,GAAAiC,CAAIJ,EAAMG,GAMR,OALKhC,KAAKG,cAAc0B,KACtB7B,KAAKG,cAAc0B,GAAQ,IAE7B7B,KAAKG,cAAc0B,GAAMF,KAAKK,GAC9BhC,KAAKoB,YAAY,CAAEU,KAAM,MAAOD,SACzB7B,IACR,CAED,GAAAkC,CAAIL,EAAMM,GAER,OADAnC,KAAKoB,YAAY,CAAEU,KAAM,MAAOD,OAAMM,SAC/BnC,IACR,CAED,IAAA2B,CAAKE,EAAMM,GACT,MAAMC,EAAKpC,KAAKO,cACV8B,EAAW,GAAGR,KAAQO,IAE5B,OADApC,KAAKkC,IAAIG,EAAUF,GACZC,CACR,CAED,MAAAE,CAAOT,EAAMM,GAEX,OADAnC,KAAKoB,YAAY,CAAEU,KAAM,SAAUD,OAAMM,SAClCnC,IACR,CAED,OAAO6B,GAEL,OADA7B,KAAKoB,YAAY,CAAEU,KAAM,SAAUD,SAC5B7B,IACR,CAED,KAAAuC,GAIE,OAHIvC,KAAKC,QACPD,KAAKC,OAAOsC,QAEPvC,IACR,eCvFI,cAAmBJ,EACxB,WAAAC,CAAYC,EAAOC,EAAU,IAC3ByC,MAAM1C,EAAOC,EACd,CAED,OAAAO,GACEN,KAAKC,OAAS,IAAIwC,EAAS,QAACzC,KAAKF,OAEjCE,KAAKC,OAAO8B,GAAG,QAAQ,KACrBW,QAAQC,IAAI,+BACZ3C,KAAK4C,gBACL5C,KAAK6C,cAAc,IAGrB7C,KAAKC,OAAO8B,GAAG,UAAW/B,KAAK8C,eAAeC,KAAK/C,OACnDA,KAAKC,OAAO8B,GAAG,QAAS/B,KAAKgD,aAAaD,KAAK/C,OAC/CA,KAAKC,OAAO8B,GAAG,SAAUkB,IACvBP,QAAQQ,MAAM,wBAAyBD,EAAI,GAE9C"}
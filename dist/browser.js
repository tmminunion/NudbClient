var Nudb=function(){"use strict";class e{constructor(e,t={}){this.wsUrl=e,this.socket=null,this.listeners={},this.dataCallbacks={},this.queue=[],this.headers=t.headers||{},this.connect()}connect(){const e="undefined"!=typeof WebSocket?WebSocket:require("ws");this.socket=new e(this.wsUrl),this.socket.onopen=()=>{for(console.log("ðŸŸ¢ WebSocket connected");this.queue.length>0;){const e=this.queue.shift();this.socket.send(JSON.stringify(e))}Object.keys(this.listeners).forEach((e=>{this.sendMessage({type:"subscribe",path:e})}))},this.socket.onmessage=e=>{try{const t=JSON.parse(e.data);"update"===t.type&&this.listeners[t.path]&&this.listeners[t.path].forEach((e=>e(t.data))),"data"===t.type&&this.dataCallbacks[t.path]&&(this.dataCallbacks[t.path].forEach((e=>e(t.data))),delete this.dataCallbacks[t.path])}catch(e){console.error("Error parsing message:",e)}},this.socket.onclose=()=>{console.warn("ðŸ”´ WebSocket disconnected. Reconnecting..."),setTimeout((()=>this.connect()),3e3)}}_generateId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="";for(let s=0;s<17;s++)t+=e.charAt(Math.floor(62*Math.random()));return`${Date.now()}${t}`}setHeader(e,t){this.headers[e]=t}sendMessage(e){const t={...e,headers:this.headers};1===this.socket.readyState?this.socket.send(JSON.stringify(t)):this.queue.push(t)}subscribe(e){this.sendMessage({type:"subscribe",path:e})}on(e,t){this.listeners[e]||(this.listeners[e]=[],this.subscribe(e)),this.listeners[e].push(t)}get(e,t){this.dataCallbacks[e]||(this.dataCallbacks[e]=[]),this.dataCallbacks[e].push(t),this.sendMessage({type:"get",path:e})}set(e,t){this.sendMessage({type:"set",path:e,data:t})}push(e,t){const s=this._generateId();return this.set(`${e}/${s}`,t),s}update(e,t){this.sendMessage({type:"update",path:e,data:t})}delete(e){this.sendMessage({type:"delete",path:e})}}return"undefined"!=typeof window&&(window.Nudb=e),e}();
